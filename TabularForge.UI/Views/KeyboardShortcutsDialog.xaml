<Window x:Class="TabularForge.UI.Views.KeyboardShortcutsDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:conv="clr-namespace:TabularForge.UI.Converters"
        mc:Ignorable="d"
        Title="Keyboard Shortcuts"
        Height="550" Width="700"
        MinHeight="400" MinWidth="550"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource WindowBackground}"
        Foreground="{DynamicResource PrimaryText}">

    <Window.Resources>
        <conv:ConflictToColorConverter x:Key="ConflictToColor" />
        <conv:CustomizedToFontWeightConverter x:Key="CustomizedToFontWeight" />
    </Window.Resources>

    <DockPanel Margin="12">
        <!-- Title -->
        <TextBlock DockPanel.Dock="Top" Text="Keyboard Shortcuts" FontSize="18"
                   FontWeight="SemiBold" Margin="0,0,0,12"
                   Foreground="{DynamicResource PrimaryText}" />

        <!-- Bottom buttons -->
        <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal"
                    HorizontalAlignment="Right" Margin="0,12,0,0">
            <Button Command="{Binding ResetAllDefaultsCommand}"
                    Padding="12,6" Margin="0,0,8,0">
                <TextBlock Text="Reset All Defaults" FontSize="12" />
            </Button>
            <Button Command="{Binding AcceptCommand}" Click="OkButton_Click"
                    Padding="16,6" Margin="0,0,8,0"
                    Background="{DynamicResource ButtonBackground}">
                <TextBlock Text="OK" FontSize="12" Foreground="{DynamicResource ButtonText}" />
            </Button>
            <Button Click="CancelButton_Click" Padding="16,6">
                <TextBlock Text="Cancel" FontSize="12" />
            </Button>
        </StackPanel>

        <!-- Status -->
        <TextBlock DockPanel.Dock="Bottom" Text="{Binding StatusText}" FontSize="11"
                   Foreground="{DynamicResource SecondaryText}" Margin="0,8,0,0" />

        <!-- Filter bar -->
        <Border DockPanel.Dock="Top" Padding="0,0,0,8">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,4,0"
                           Foreground="{DynamicResource SecondaryText}" FontSize="12" />
                <TextBox Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}"
                         Width="180" Margin="0,0,12,0" Padding="4,3" FontSize="12" />

                <TextBlock Text="Category:" VerticalAlignment="Center" Margin="0,0,4,0"
                           Foreground="{DynamicResource SecondaryText}" FontSize="12" />
                <ComboBox ItemsSource="{Binding Categories}"
                          SelectedItem="{Binding SelectedCategory}"
                          Width="100" FontSize="12" />
            </StackPanel>
        </Border>

        <!-- Shortcut assignment area -->
        <Border DockPanel.Dock="Bottom" Padding="0,8,0,0"
                Visibility="{Binding SelectedShortcut, Converter={StaticResource NullToVis}}">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="New Shortcut:" VerticalAlignment="Center" Margin="0,0,8,0"
                           Foreground="{DynamicResource SecondaryText}" FontSize="12" />
                <TextBox Text="{Binding NewGesture, UpdateSourceTrigger=PropertyChanged}"
                         Width="150" Padding="4,3" FontSize="12"
                         ToolTip="Type the key gesture (e.g. Ctrl+Shift+F)" />
                <Button Command="{Binding AssignGestureCommand}" Padding="12,4" Margin="8,0,0,0">
                    <TextBlock Text="Assign" FontSize="12" />
                </Button>
                <Button Command="{Binding ResetToDefaultCommand}" Padding="12,4" Margin="4,0,0,0">
                    <TextBlock Text="Reset" FontSize="12" />
                </Button>
            </StackPanel>
        </Border>

        <!-- Shortcut list -->
        <DataGrid ItemsSource="{Binding FilteredShortcuts}"
                  SelectedItem="{Binding SelectedShortcut}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  CanUserSortColumns="True"
                  SelectionMode="Single"
                  IsReadOnly="True"
                  GridLinesVisibility="Horizontal"
                  HorizontalGridLinesBrush="{DynamicResource BorderBrush}"
                  HeadersVisibility="Column"
                  FontSize="12"
                  VirtualizingPanel.IsVirtualizing="True">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Command" Binding="{Binding CommandName}" Width="180" />
                <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="80" />
                <DataGridTextColumn Header="Default" Binding="{Binding DefaultKeyGesture}" Width="120" />
                <DataGridTemplateColumn Header="Current" Width="140">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding EffectiveGesture}"
                                       FontWeight="{Binding IsCustomized, Converter={StaticResource CustomizedToFontWeight}}"
                                       Foreground="{Binding HasConflict, Converter={StaticResource ConflictToColor}}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn Header="Conflict" Binding="{Binding ConflictWith}" Width="*">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="Foreground" Value="{DynamicResource ErrorText}" />
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
            </DataGrid.Columns>
        </DataGrid>
    </DockPanel>
</Window>
