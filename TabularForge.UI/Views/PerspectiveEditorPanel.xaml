<UserControl x:Class="TabularForge.UI.Views.PerspectiveEditorPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             Background="{DynamicResource EditorBackground}">

    <DockPanel>
        <!-- Toolbar -->
        <Border DockPanel.Dock="Top" Background="{DynamicResource ToolBarBackground}"
                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1"
                Padding="4,4">
            <WrapPanel>
                <Button Command="{Binding LoadPerspectivesCommand}" ToolTip="Reload perspectives from model"
                        Padding="8,4" Margin="0,0,4,0">
                    <TextBlock Text="Refresh" FontSize="12" />
                </Button>
                <Button Command="{Binding SavePerspectivesCommand}" ToolTip="Save perspective changes"
                        Padding="8,4" Margin="0,0,4,0">
                    <TextBlock Text="Save" FontSize="12" />
                </Button>

                <Border Width="1" Background="{DynamicResource SeparatorBrush}" Margin="4,2" />

                <!-- Add Perspective -->
                <TextBox Text="{Binding NewPerspectiveName, UpdateSourceTrigger=PropertyChanged}"
                         Width="120" Margin="4,0" Padding="4,3" FontSize="12"
                         ToolTip="New perspective name" />
                <Button Command="{Binding AddPerspectiveCommand}" ToolTip="Add perspective"
                        Padding="8,4" Margin="0,0,4,0">
                    <TextBlock Text="+ Perspective" FontSize="12" />
                </Button>
                <Button Command="{Binding RemovePerspectiveCommand}" ToolTip="Remove selected perspective"
                        Padding="8,4" Margin="0,0,4,0">
                    <TextBlock Text="- Perspective" FontSize="12" Foreground="{DynamicResource ErrorText}" />
                </Button>

                <Border Width="1" Background="{DynamicResource SeparatorBrush}" Margin="4,2" />

                <!-- Bulk Operations -->
                <TextBlock Text="Perspective:" VerticalAlignment="Center" Margin="0,0,4,0"
                           Foreground="{DynamicResource SecondaryText}" FontSize="12" />
                <ComboBox ItemsSource="{Binding Perspectives}"
                          SelectedItem="{Binding SelectedPerspective}"
                          Width="120" Margin="0,0,4,0" FontSize="12" />
                <Button Command="{Binding SelectAllCommand}" ToolTip="Select all in perspective"
                        Padding="8,4" Margin="0,0,2,0">
                    <TextBlock Text="All" FontSize="12" />
                </Button>
                <Button Command="{Binding DeselectAllCommand}" ToolTip="Deselect all in perspective"
                        Padding="8,4" Margin="0,0,2,0">
                    <TextBlock Text="None" FontSize="12" />
                </Button>
                <Button Command="{Binding SelectAllOfTypeCommand}"
                        ToolTip="Select all of filtered type in perspective"
                        Padding="8,4" Margin="0,0,4,0">
                    <TextBlock Text="Type" FontSize="12" />
                </Button>
            </WrapPanel>
        </Border>

        <!-- Filter Bar -->
        <Border DockPanel.Dock="Top" Padding="4,4"
                Background="{DynamicResource PanelBackground}"
                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Filter:" VerticalAlignment="Center" Margin="0,0,4,0"
                           Foreground="{DynamicResource SecondaryText}" FontSize="12" />
                <TextBox Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}"
                         Width="150" Margin="0,0,8,0" Padding="4,3" FontSize="12" />

                <TextBlock Text="Type:" VerticalAlignment="Center" Margin="0,0,4,0"
                           Foreground="{DynamicResource SecondaryText}" FontSize="12" />
                <ComboBox ItemsSource="{Binding ObjectTypeOptions}"
                          SelectedItem="{Binding SelectedObjectType}"
                          Width="100" Margin="0,0,8,0" FontSize="12" />

                <TextBlock Text="Table:" VerticalAlignment="Center" Margin="0,0,4,0"
                           Foreground="{DynamicResource SecondaryText}" FontSize="12" />
                <ComboBox ItemsSource="{Binding TableNames}"
                          SelectedItem="{Binding SelectedTable}"
                          Width="150" FontSize="12" />
            </StackPanel>
        </Border>

        <!-- Status Bar -->
        <Border DockPanel.Dock="Bottom" Padding="4,2"
                Background="{DynamicResource PanelBackground}"
                BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,1,0,0">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="{Binding StatusText}" FontSize="11"
                           Foreground="{DynamicResource SecondaryText}" />
                <TextBlock Text=" | " Foreground="{DynamicResource SecondaryText}" FontSize="11"
                           Visibility="{Binding HasChanges, Converter={StaticResource BoolToVis}}" />
                <TextBlock Text="Unsaved changes" FontSize="11"
                           Foreground="{DynamicResource WarningText}"
                           Visibility="{Binding HasChanges, Converter={StaticResource BoolToVis}}" />
            </StackPanel>
        </Border>

        <!-- Perspective Membership Grid -->
        <DataGrid ItemsSource="{Binding Memberships}"
                  SelectedItem="{Binding SelectedMembership}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  CanUserReorderColumns="True"
                  CanUserSortColumns="True"
                  SelectionMode="Single"
                  GridLinesVisibility="All"
                  HorizontalGridLinesBrush="{DynamicResource BorderBrush}"
                  VerticalGridLinesBrush="{DynamicResource BorderBrush}"
                  HeadersVisibility="Column"
                  FontSize="12"
                  VirtualizingPanel.IsVirtualizing="True"
                  VirtualizingPanel.VirtualizationMode="Recycling">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Table" Binding="{Binding TableName}" Width="120"
                                    IsReadOnly="True" />
                <DataGridTextColumn Header="Object" Binding="{Binding ObjectName}" Width="150"
                                    IsReadOnly="True" />
                <DataGridTextColumn Header="Type" Binding="{Binding ObjectType}" Width="80"
                                    IsReadOnly="True" />
            </DataGrid.Columns>
        </DataGrid>
    </DockPanel>
</UserControl>
